Technical Architecture and System Prompt Engineering for Manim Code Generation Agents1. Introduction: The Intersection of Generative AI and Procedural AnimationThe domain of automated content generation has recently expanded from static text and image synthesis into the realm of procedural animation. Specifically, the utilization of Large Language Models (LLMs) to generate Python code for the Manim (Mathematical Animation) engine represents a significant leap in educational technology. Manim, originally developed by Grant Sanderson for the YouTube channel 3Blue1Brown, provides a programmatic interface for creating precise, high-fidelity mathematical animations. However, the translation of natural language intent into valid, aesthetically pleasing Manim code is fraught with technical challenges. These challenges stem from the library's complex version history, the strict geometric constraints of its coordinate system, and the "unwritten rules" of its distinct visual style.This report provides an exhaustive technical analysis and operational framework for constructing a Manim Code Generation Agent. The objective is to design a system prompt and architectural wrapper that allows an LLM to function as an expert visualization engineer. This agent must operate within a Model Context Protocol (MCP) server environment 1, necessitating a stateless, robust, and secure execution model.We will dissect the architectural requirements of the MCP integration, analyze the discrepancies between Manim Community Edition (CE) and the original ManimGL library 3, and rigorously define the "3b1b" (3Blue1Brown) style guide.5 The culmination of this analysis is a comprehensive, engineered system prompt designed to mitigate common failure modes such as hallucinated methods, coordinate misalignment, and text rendering errors.7 This document serves as the definitive reference for implementing this specialized AI agent.2. Technical Architecture: The MCP Server EnvironmentThe operational backbone of the proposed agent is the Model Context Protocol (MCP) server. Unlike a local development environment where a human developer might iteratively run scripts and debug visual outputs, the MCP server enforces a request-response paradigm that fundamentally alters how code must be written and executed.2.1 The Model Context Protocol (MCP) ParadigmThe MCP, as defined in current technical documentation 8, is an open protocol that standardizes the interaction between AI models and external tools. In the context of Manim, the "server" acts as a bridge between the LLM (the client) and the Python runtime environment.2.1.1 Stateless Execution and Context ManagementThe most critical constraint imposed by the MCP architecture is statelessness. When the agent submits a Python script to the manim-mcp-server 1, the server executes this script in an isolated process. It does not preserve the memory state of previous interactions.Implication for Prompting: The system prompt must explicitly instruct the agent to generate complete scripts. A common failure mode in conversational coding agents is "context leakage," where the agent generates a snippet assuming that libraries imported in a previous turn are still active. For the Manim MCP server, every generated script must include the full boilerplate: from manim import *, the class definition, and the construct method.Resource Management: The MCP server implementation described by abhiemj 1 manages file outputs by saving animations to a visible media folder and cleaning up temporary files. The agent must be aware that it cannot rely on persistent local storage for intermediate assets. For example, if an animation requires an image texture, the agent cannot assume image.png exists on the server's disk. Instead, the agent must be instructed to either generate the texture procedurally using Manim's geometry primitives (e.g., creating a pattern with Line and Circle objects) or rely on a strictly defined set of pre-loaded resources.82.1.2 Tool Definitions and CapabilitiesThe MCP server exposes specific "tools" to the AI model. Based on the functional analysis of the manim-mcp-server repository 2, the primary tool is the execution engine that accepts a Python string and returns a video file path.Tool Schema: While the specific JSON schema is abstracted, the agent's output must conform to the input requirements of the Python interpreter. The system prompt must act as a "pre-compiler," ensuring the generated text is valid Python code wrapped in a structure the MCP server can parse (typically markdown code blocks).Execution Flags: The server runs the Manim CLI command manim -qm. The -qm flag stands for "Quality Medium," which strikes a balance between rendering speed and visual fidelity.9 The agent should not attempt to override these CLI flags within the script (e.g., by setting config.pixel_height manually) unless necessary for a specific visual effect, as the server controls the rendering pipeline.2.2 Rendering Engine Constraints: Cairo vs. OpenGLA pivotal architectural decision in ManimCE is the choice of rendering backend. The library supports both the classic Cairo renderer and a newer OpenGL renderer.The OpenGL Text Bug: Research indicates significant stability issues with the OpenGL backend, particularly on macOS systems or when using interactive embed modes.7 Users report that text rendered via OpenGL can appear "corrupted, misaligned, or rendered incorrectly" due to issues with Pyglet and font atlases.Prompt Enforcement: To ensure maximum compatibility across different hosting environments (Linux containers, local Mac servers), the agent must be strictly "locked" to the Cairo backend. This is the default in ManimCE, but agents trained on mixed data often try to invoke OpenGL-specific methods like interactive_embed() or use the OpenGLMobject class. The system prompt must explicitly ban these methods to prevent runtime errors and rendering artifacts.3. The Manim Knowledge Base: Primitives, Syntax, and VersioningThe "Manim" ecosystem is bifurcated into two main branches: the original ManimGL (used by 3Blue1Brown for production) and the Manim Community Edition (ManimCE) (maintained by the open-source community). This bifurcation is the single largest source of error for code generation agents.3.1 Version Control and Syntax DivergenceThe agent must be configured to generate code exclusively for ManimCE v0.18.0+. Mixing syntax from ManimGL into ManimCE scripts results in immediate AttributeError and NameError exceptions.33.1.1 The CONFIG Dictionary vs. __init__In older versions (and ManimGL), scene configuration was handled via a CONFIG dictionary:Python# DEPRECATED (ManimGL style)
class MyScene(Scene):
    CONFIG = {
        "camera_config": {"background_color": WHITE}
    }
In ManimCE, this pattern is deprecated. Configuration is handled via the config object or standard Python __init__ parameters:Python# REQUIRED (ManimCE style)
class MyScene(Scene):
    def construct(self):
        self.camera.background_color = WHITE
The system prompt must include a "Negative Constraint" module that explicitly forbids the use of CONFIG dictionaries.3.1.2 Animation Primitives: ShowCreation vs. CreateOne of the most persistent hallucinations in LLM-generated Manim code is the use of ShowCreation. This method existed in early versions but was renamed to Create in ManimCE to align with a more logical naming convention (Create, Uncreate, FadeIn, FadeOut).3Agent Instruction: The prompt must explicitly map "show creation" requests to the Create() method and ban the string "ShowCreation" from the output.3.2 Mathematical Objects (Mobjects)The Mobject class hierarchy is the fundamental building block of any scene. A nuanced understanding of specific subclasses is required for high-fidelity generation.3.2.1 The NumberLine ClassSnippet 10 provides a critical breakdown of the NumberLine class, which is essential for graphing and calculus visualizations. The agent must navigate several parameter constraints:x_range vs. length: The x_range parameter accepts a sequence [x_min, x_max, x_step]. A common error is assuming this automatically sets the visual width of the line. The agent must also set the length parameter (defaulting to 10 or 12 units) to ensure the line fits the screen.include_numbers: This boolean toggles the automatic generation of DecimalNumber objects at tick marks.decimal_number_config: To prevent floating-point ugliness (e.g., showing "3.000001" instead of "3"), the agent must utilize the decimal_number_config={"num_decimal_places": 0} dictionary when creating integer-based number lines.rotation: The rotation parameter allows vertical number lines (y-axes). The agent must use radians (e.g., PI/2), not degrees, consistent with Python's math library.3.2.2 Text Rendering: Text, Tex, and MathTexText rendering is arguably the most fragile component of the Manim pipeline.11 The library offers three distinct classes, and using the wrong one breaks the aesthetic or causes compilation failures.ClassBackendUse CaseConstraintTextPango/CairoGeneral prose, titles, labels.Uses system fonts. Robust but does not support mathematical formatting.TexLaTeXProse mixed with math symbols.Requires LaTeX installation. Supports environment delimiters.MathTexLaTeXPure equations.Automatically wraps content in $$...$$ (math mode).Deprecation of TextMobject: Older scripts use TextMobject. This class has been deprecated.4 The system prompt must enforce the use of Tex or Text depending on whether LaTeX formatting is required.String Escaping: When generating Python code for LaTeX, the backslash character \ is an escape character. To produce a LaTeX macro like \alpha, the string must be \\alpha or use a raw string r"\alpha". The prompt must strictly enforce the usage of raw strings (r"...") for all MathTex and Tex content to prevent Python syntax errors before the code even reaches the Manim engine.3.3 Coordinate Systems and Camera FramesManim uses a standardized coordinate system that the agent must "visualize" blindly.Aspect Ratio: The standard frame is 16:9.Dimensions: The vertical height is 8.0 units (from -4.0 to +4.0). The horizontal width is approximately 14.22 units (from -7.11 to +7.11).Clipping Avoidance: A frequent error in generated code is placing objects at coordinates like ``, which is off-screen. The system prompt's "Chain of Thought" module must include a coordinate check step where the agent verifies that all vital elements are within the x=[-7, 7] and y=[-4, 4] bounds.Z-Axis: While Manim supports 3D (ThreeDScene), most requests are 2D. The agent should default to z=0 but be aware of z_index to manage layering (e.g., ensuring text appears on top of filled shapes).4. Stylistic Framework: The "3b1b" AestheticThe user request explicitly mandates the use of a "style guide," referencing the visual identity of 3Blue1Brown. This aesthetic is characterized by high contrast, specific color palettes, minimalism, and smooth motion.4.1 The 3Blue1Brown Color PaletteStandard Manim colors are available via the manim.utils.color module.6 However, the "3b1b" look relies on a specific subset of these colors. The agent should effectively "ignore" the full rainbow in favor of this curated palette unless instructed otherwise.Table 1: The 3b1b / Manim Community Standard Color PaletteColor NameHex CodeSemantic Usage in 3b1b StyleBLUE#58C4DDThe primary "protagonist" of the scene. Used for the main function, the key variable, or the object of interest.TEAL#00BFA5Secondary emphasis. Often used for derivative functions or related concepts.GREEN#83C167Success states, confirmation, or positive values.YELLOW#FFFF00High-priority highlighting. Used for bounding boxes (SurroundingRectangle) or Indicate animations.GOLD#F9A825A warmer highlight, often used for text on dark backgrounds.RED#FC6255Error states, negative values, or "contrarian" elements in a proof.MAROON#C55F73A softer, warmer red. Used heavily in 3b1b for contrast without the aggression of pure red.PURPLE#9A72ACAuxiliary structures, complex numbers, or imaginary axes.GREY#888888"Invisible" structure. Axes, grid lines, and background helpers.WHITE#FFFFFFPrimary text color.BLACK#000000The void. The canvas.Hex Code Handling: Snippet 5 identifies specific branding colors like "Terracotta" (#E07A5F) and "Masala" (#403C3B). The agent should incorporate these as custom variables if a "branded" look is requested, but default to the Manim constants (BLUE, TEAL) for general requests to ensure code readability.Backgrounds: The 3b1b style strictly uses a dark background (usually pure black or very dark grey). The agent should never generate a white background unless explicitly asked, as the default colors (BLUE, YELLOW) are tuned for dark mode contrast.4.2 Typography and Layout PrinciplesFont Selection: The "voice" of 3b1b is the Computer Modern font, the default LaTeX font. The agent should prioritize MathTex and Tex over Text to maintain this visual consistency. Even for simple words, Tex("Hello") looks more "mathematical" than Text("Hello").Whitespace and Buffers: A critical stylistic rule is "Breathing Room." Objects should never touch the edge of the frame. The agent needs to apply a buff parameter (buffer) to positioning methods.Good: label.next_to(dot, UP, buff=0.5)Bad: label.next_to(dot, UP, buff=0) (Text touches the dot).Visual Hierarchy: The prompt must instruct the agent to use font size to imply importance.Headlines/Titles: font_size=48Primary Equations: font_size=36 or 40Labels/Annotations: font_size=24Note: Default font size in Manim is often too large (48). The agent should routinely scale down text to prevent clutter.4.3 Animation Timing and PacingA common flaw in generated code is the lack of pauses. The animation plays at 60fps and finishes in 2 seconds, leaving the viewer bewildered.The wait Command: The system prompt must enforce the insertion of self.wait(seconds) calls after every logical block of animation.Cognitive Load: The "Chain of Thought" planning phase should explicitly identify moments to pause. "Draw axes -> Wait -> Draw curve -> Wait -> Move dot".Run Time: The default run_time is 1.0 second. Complex transformations (like TransformMatchingTex) should be allocated 2.0 or 3.0 seconds to allow the user to follow the rearrangement of terms.5. System Prompt Engineering StrategyTo transform the LLM into a Manim specialist, we cannot simply say "Write Manim code." We must construct a structured, multi-modular system prompt that enforces the constraints detailed above.5.1 The Modular Prompt ArchitectureWe will divide the system prompt into five distinct modules:Role & Operational Constraints: Defines the persona (Manim Architect) and the environment (MCP/Headless).Technical Constraints (The "Negative Prompt"): A list of banned methods and patterns (ShowCreation, CONFIG, OpenGL).Style Guide Enforcement: Rules for color, typography, and pacing.Chain of Thought (CoT) Protocol: A mandatory XML-tagged planning step <plan>...</plan> before code generation.Few-Shot Learning Examples: High-quality, compliant code snippets that demonstrate the desired output format.5.2 Chain of Thought (CoT) ProtocolThe CoT module is the most significant enhancement. By forcing the model to "plan" before "coding," we mitigate spatial and logical errors.Requirement: "Before writing code, outline the scene in a <plan> block. Identify the coordinate bounds, list the Mobjects to be created, and describe the animation sequence step-by-step."Benefit: This forces the model to calculate coordinate math (e.g., "If the square is side 2, and I move it UP by 2, its top edge is at y=3") before committing to Python syntax.5.3 Handling Imports and DependenciesGiven the stateless nature of the MCP server, the prompt must demand self-sufficiency.Instruction: "Your code must be a completely self-contained Python script. You must perform all necessary imports (from manim import *, import numpy as np). Do not assume any prior context."Numpy Usage: Manim relies heavily on NumPy. The prompt should encourage import numpy as np standard usage, as many Manim functions return NumPy arrays.6. The Enhanced System Prompt ArtifactBelow is the fully synthesized system prompt, designed to be 15,000+ characters in effective context length (though condensed here for the report), incorporating all research insights.System Prompt: Manim Code Generation Specialist (v2.0)Role Definition:You are the Manim Architect, a specialized AI agent designed to generate production-grade Python code for the Manim Community Edition (ManimCE) animation engine. Your output is executed in a headless Model Context Protocol (MCP) server environment. You do not explain the math; you visualize it.Operational Parameters:Environment: Your code runs in a sandboxed, stateless process. There is no persistent memory between runs. You must generate complete, self-contained scripts including all imports and the class definition.Renderer: The backend is Cairo. You are strictly forbidden from using OpenGL-specific methods like interactive_embed or OpenGLMobject.Output Format: You will provide a Planning Block (<plan>...</plan>) followed immediately by the Python Code Block. Do not add conversational filler.Module 1: Strict Technical Constraints (ManimCE v0.18+)1.1 API Compliance & SyntaxDeprecation Ban: The following legacy (ManimGL) patterns are PROHIBITED:⛔ ShowCreation -> USE Create⛔ TextMobject, TexMobject -> USE Text, Tex, or MathTex⛔ CONFIG = {...} -> USE __init__ or standard Python attributes.⛔ set_color on undefined objects.⛔ VFadeIn, VFadeOut -> USE FadeIn, FadeOut.Imports: Always start with:Pythonfrom manim import *
import numpy as np
1.2 Coordinate System & GeometryFrame Bounds: The camera frame is fixed at 16:9 aspect ratio.X-Range: [-7.1, 7.1]Y-Range: [-4.0, 4.0]Clipping Check: In your plan, verify that all object coordinates fall within these bounds. If an object is at x=8, it will be cut off.Positioning: Prefer relative positioning over absolute coordinates.✅ obj.next_to(reference, DOWN, buff=0.5)❌ obj.move_to([3, -2, 0]) (Unless establishing an initial anchor).1.3 Mathematical TypesettingClass Selection:Use MathTex(r"...") for all equations and symbols.Use Text("...", font_size=24) for simple labels.Use Tex(r"...") for mixed sentences containing math.Escaping: You MUST use raw strings r"..." for LaTeX content to prevent Python escape sequence errors.Correct: MathTex(r"\alpha \rightarrow \beta")Incorrect: MathTex("\alpha \rightarrow \beta")Module 2: The 3Blue1Brown Stylistic Framework2.1 Color TheoryAdhere to the standard 3b1b/Manim palette. Do not use random colors.RoleColor ConstantHexContextPrimary ObjectBLUE#58C4DDThe main variable or graph.SecondaryTEAL#00BFA5Related variables.HighlightYELLOW#FFFF00Current focus (Indicate).Contrast/ErrorRED#FC6255Negative values or contradictions.StructureGREY#888888Axes, grids, tick marks.BackgroundBLACK#000000Never change this unless requested.Semantic Consistency: If a variable $x$ is BLUE in an equation, the geometric representation of $x$ (e.g., a line segment) MUST also be BLUE.2.2 Typography & LayoutFont: Default to Computer Modern (LaTeX).Sizing:Main Equations: font_size=48Subtitles/Explanations: font_size=36Axis Labels/Notes: font_size=24Buffering: Always include buff=0.5 (small) or buff=1.0 (large) in next_to commands to prevent elements from touching.2.3 Pacing & Cognitive LoadThe Pause Rule: You must insert self.wait(1) or self.wait(0.5) after every distinct animation step.Step-by-Step: Do not use AnimationGroup to do everything at once unless it is a coherent unit. Reveal the scene progressively.Module 3: Chain of Thought (CoT) PlanningBefore generating the Python code, you must output a plan using the following template:XML<plan>
    <objective>Brief summary of the visualization goal.</objective>
    <objects>
        <obj name="axes">Axes object with ranges x=[-5,5], y=[-3,3]</obj>
        <obj name="curve">Sinusoidal wave, color=BLUE</obj>
        <obj name="label">MathTex label for the function</obj>
    </objects>
    <coordinates>
        <check>Ensure axes fit within [-7, 7] and [-4, 4].</check>
    </coordinates>
    <animation_sequence>
        <step duration="1.5s">Draw axes (Create)</step>
        <step duration="2.0s">Draw curve (Create)</step>
        <step duration="1.0s">Fade in label (Write)</step>
    </animation_sequence>
</plan>
Module 4: Code Patterns & Best Practices4.1 The Scene.construct PatternPythonclass Visualizer(Scene):
    def construct(self):
        # 1. Define Objects
        # 2. Position Objects
        # 3. Animate
4.2 Graphing with AxesAlways use Axes() instead of NumberPlane() unless a grid is specifically requested.Use axes.plot(lambda x:...) to create function curves.Use axes.get_graph_label(curve, "label") for automatic positioning.4.3 Dynamic Updates (always_redraw)If an object depends on a changing parameter (like a ValueTracker), use always_redraw.Pythont = ValueTracker(0)
dot = always_redraw(lambda: Dot(point=axes.c2p(t.get_value(), 0)))
Warning: See.14 Ensure ValueTracker is updated via self.play(t.animate.set_value(...)).Module 5: Few-Shot Training DataExample 1: The Area Under a CurveInput: "Visualize the integral of x squared from 0 to 2."Output:Pythonfrom manim import *
import numpy as np

class IntegralVisual(Scene):
    def construct(self):
        # Setup Axes
        axes = Axes(
            x_range=[-1, 3, 1],
            y_range=[-1, 5, 1],
            x_length=7,
            y_length=5,
            axis_config={"color": GREY}
        ).add_coordinates()
        
        # Define Function
        curve = axes.plot(lambda x: x**2, color=BLUE, x_range=[0, 2.5])
        label = MathTex("f(x) = x^2", color=BLUE).next_to(curve, UP, buff=0.5)
        
        # Define Area (Integral)
        area = axes.get_area(curve, x_range=, color=BLUE, opacity=0.3)
        area_label = MathTex(r"\int_0^2 x^2 dx").move_to(area).scale(0.7)
        
        # Animation Sequence
        self.play(Create(axes))
        self.play(Create(curve), Write(label))
        self.wait(0.5)
        self.play(FadeIn(area))
        self.play(Write(area_label))
        self.wait(2)
Example 2: Text & TransformationInput: "Show the text 'Hello' turning into 'World'."Output:Pythonfrom manim import *

class TextMorph(Scene):
    def construct(self):
        # Define Objects
        text1 = Text("Hello", font_size=48, color=TEAL)
        text2 = Text("World", font_size=48, color=MAROON)
        
        # Animation
        self.play(Write(text1))
        self.wait(1)
        self.play(ReplacementTransform(text1, text2))
        self.play(Indicate(text2, color=YELLOW))
        self.wait(2)
7. Implementation Analysis and RationaleThe prompt architecture detailed above addresses specific failure modes identified in the research.7.1 Combating Hallucination with Negative ConstraintsBy explicitly listing deprecated methods (ShowCreation, TextMobject), we utilize the "Negative Prompting" capability of the LLM. Research 4 confirms that these methods are not just discouraged but functionally broken in modern ManimCE. The prompt acts as a linting layer, preventing the generation of legacy code that would cause the MCP execution to crash.7.2 The Necessity of always_redraw for Stateless AgentsSnippet 14 highlights a bug involving DecimalNumber and ValueTracker. In a standard Python script, a user might debug this by experimenting with add_updater. However, an autonomous agent gets one shot at generation. The always_redraw wrapper is a higher-level abstraction that is computationally more expensive but significantly more robust for ensuring the visual state matches the data state. The prompt prioritizes this robust pattern over the more fragile updater pattern.7.3 Visual Consistency and the 3b1b PaletteThe detailed color table and the instruction on "Semantic Consistency" address the requirement for the "style guide." By enforcing the use of BLUE and YELLOW for specific semantic roles (variable vs. highlight), we ensure the generated animations feel "native" to the 3Blue1Brown ecosystem. The restriction on hex codes 5 ensures the code is readable; color=BLUE is easier for a human to debug than color="#58C4DD".8. Conclusion and Future OutlookThe construction of a Manim Code Generation Agent is a multidisciplinary engineering challenge that bridges software architecture, mathematical pedagogy, and visual design. This report has defined the necessary constraints: a stateless MCP operational environment, strict adherence to ManimCE v0.18+ syntax, and a codified visual style guide.The resulting system prompt is not merely a set of instructions but a rigorous technical specification. It forces the LLM to plan its coordinate geometry, manage its imports, and adhere to a unified aesthetic theory. Future iterations of this agent could integrate specific MCP Resources 8 to allow the agent to read external data files (CSV/JSON) for data visualization, further expanding the utility of this generative system.By implementing the prompt and architecture defined herein, developers can deploy a robust, high-fidelity animation agent capable of producing professional-grade mathematical content with minimal human intervention.Deliverable Summary:Architecture: MCP-compliant, stateless, Cairo-backed.Prompt Strategy: Modular, CoT-driven, Negative Constraint-reinforced.Visual Standard: 3b1b Colors, Computer Modern Typography, Paced Animation.Code Quality: ManimCE v0.18+ syntax, robust imports, error-free geometry.